# Today I Learned

> 2025년 04월 28일

데모 계정 라우팅 제한 문제와 해결 과정

1. 처음 시도: 각 페이지에서 isDemo로 이동 제한
데모 계정일 때 커뮤니티(/community)와 마이페이지(/my-page)로 이동하는 것을 막기 위해, 각 페이지 컴포넌트 내부에 isDemo 조건을 추가했다.
하지만 주소창(URL)을 직접 수정해서 접근할 경우, 여전히 해당 페이지로 이동되는 문제가 발생했다.

2. 두 번째 시도: useEffect로 막기
각 페이지에서 useEffect를 사용하여 데모 계정이면 접근을 막고 리다이렉트하도록 시도했다.
그러나 useEffect는 컴포넌트가 마운트된 이후에 실행되기 때문에, URL 변경이 일어난 후 잠깐이라도 원치 않는 페이지가 보이는 문제가 있었다.
또한, 사이드바(WSidebar)처럼 특정 컴포넌트가 마운트되지 않는 경우에는 useEffect 자체가 실행되지 않아 막을 수 없는 경우도 있었다.

3. 원인: 타이밍과 스코프의 문제
useEffect는 컴포넌트가 렌더링된 후에 실행되므로, URL이 먼저 바뀐 다음에 체크가 이루어짐.
컴포넌트마다 체크를 하면, 컴포넌트가 없는 페이지나 특정 상황에서는 통제가 불가능하다.

4. 근본적 해결: 라우터 레벨에서 제한
라우터 설정 단계에서 접근을 통제하는 protectedRoute패턴(특정 조건을 만족하지 않으면 접근을 막는) 방식을 적용하면,
URL이 변경되는 즉시 데모 계정 여부를 확인하고 리다이렉트할 수 있다.
컴포넌트가 마운트되기 전 단계에서 제어되기 때문에, 잠깐이라도 화면이 노출되는 문제가 없다.
모든 경로 이동을 중앙에서 일괄적으로 관리할 수 있어 유지보수성도 좋아진다.
```
	// 데모 버전에서 커뮤니티 페이지와 마이페이지 접근 차단
	if (
		userInfo?.isDemo &&
		(window.location.pathname.startsWith("/community") ||
			window.location.pathname === "/my-page")
	) {
		return <Navigate to="/error" replace />;
	}
```

5. 결론
컴포넌트 레벨이 아닌, 라우터 레벨에서 데모 계정 제한을 걸어야 한다.
그래야 URL 직접 입력, 새로고침, 경로 이동 등 모든 경우를 안전하게 막을 수 있다.
